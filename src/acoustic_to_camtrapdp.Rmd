---
title: "acoustic_to_camtrapdp"
author: "Sanne Govaert"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#I made a BIIIGGGGG change
library(here)
library(dplyr)
library(tidyr)
library(frictionless)
```


```{r}
data_raw <- read.csv(here::here("data", "raw", "birdnet_lite_detections-proj_sound-of-norway-yr2complete.csv"))
data <- data_raw[1:5000,]
```

# Create resources

## Inspect data

```{r}
(unique_values_per_column <-
  data %>%
  summarise(across(everything(), ~ n_distinct(.))) %>%
  pivot_longer(everything(), names_to = "column", values_to = "n_unique"))
```

## Create deployments resource

```{r}
deployments <-
  data %>% 
  dplyr::mutate(
    deploymentID = NULL, # Required
    locationID = NULL,
    locationName = NULL,
    latitude = NULL, # Required
    longitude = NULL, # Required
    coordinateUncertainty = NULL,
    deploymentStart = NULL, # Required
    deploymentEnd = NULL, # Required
    setupBy = NULL,
    deviveID = NULL,
    ddeviceModel = NULL,
    deviceDelay = NULL,
    deviceHeight = NULL,
    deviceDepth = NULL,
    deviceTilt = NULL,
    deviceHeading = NULL,
    dutyCycle = NULL,
    detectionDistance = NULL,
    timestampIssues = NULL,
    devicePlatform = NULL,
    baitUse = NULL,
    featureType = NULL,
    habitat = NULL,
    deploymentGroups = NULL,
    deploymentTags = NULL,
    deploymentComments = NULL,
    .keep = "none"
  )
```

## Create media resource

```{r}
media <-
  data %>% 
  dplyr::mutate(
    medidaID = NULL, # Required
    deploymentID = NULL, # Required
    captureMethod = NULL,
    timestamp = NULL, # Required
    filePath = NULL,# Required
    filePublic = NULL, # Required
    fileName = NULL,
    fileMediatype = NULL, # Required
    samplingFrequency = NULL,
    bitDepth = NULL,
    gain = NULL,
    channels = NULL,
    duration = NULL,
    exifData = NULL,
    favorite = NULL,
    mediaComments = NULL,
    .keep = "none"
  )
```

## Create observations resource

```{r}
observations <-
  data %>% 
  dplyr::mutate(
    observationID = .data$id, # Required
    deploymentID = NULL, # Required
    mediaID = NULL,
    eventID = NULL,
    eventStart = NULL, # Required
    eventEnd = NULL, # Required
    observationLevel = NULL, # Required
    observationType = NULL, # Required
    deviceSetupType = NULL,
    scientificName = NULL,  # Required
    count = NULL,
    lifeStage = NULL,
    sex = NULL,
    behavior = NULL,
    individualID = NULL,
    individualPositionRadius = NULL,
    individualPositionAngle = NULL,
    individualSpeed = NULL,
    bboxX = NULL,
    bboxY = NULL,
    bboxWidth = NULL,
    bboxHeight = NULL,
    frequencyLow = NULL,
    frequencyHigh = NULL,
    classificationMethod = NULL,
    classifiedBy = NULL,
    classificationTimestamp = NULL,
    classificationProbability = NULL,
    observationTags = NULL,
    observationComments = NULL,
    .keep = "none"
  )
```

# Create data package

```{r}
acoustic <-
  frictionless::create_package() %>%
  add_resource(resource_name = "deployments", data = deployments) %>%
  add_resource(resource_name = "media", data = media) %>%
  add_resource(resource_name = "observations", data = observations) %>%
  append(c(
    "name" = "camtrap-dp-acoustic-example-dataset", # Required
    "path" = NULL, # Required (Sanne will do this)
    "profile" = NULL, # Required (Sanne will do this)
    "schema" = NULL, # Required (Sanne will do this)
    "id" = NULL,
    "created" = Sys.time(), # Required
    "title" = "Sound of Norway: bird detections",
    "contributors" = list( # Required
      list(
        title = "Julia Wiel",
        email = "julia.wiel@nina.no",
        path = NULL,
        role = "principalInvestigator",
        organization = "Norwegian Institute for Nature Research (NINA)"
      ),
      list(
        title = "Benjamin Cretois",
        email = "benjamin.cretois@nina.no",
        path = "https://orcid.org/0000-0001-8668-3321",
        role = "principalInvestigator",
        organization = "Norwegian Institute for Nature Research (NINA)"
      )
    ),
    "description" = NULL,
    "version" = "1.0",
    "keywords" = c("acoustic", "birds"),
    "image" = NULL,
    "homepage" = NULL,
    "sources" = NULL,
    "licenses" = list(
      list(
        name = "CC0-1.0",
        scope = "data" # Required
        ), 
      list(
        path = "http://creativecommons.org/licenses/by/4.0/", 
        scope = "media" # Required
        )
      ),
    "bibliographicCitation" = NULL,
    "project" = list( # Required
      id = NULL,
      title = "Sound of Norway", # Required
      acronym = NULL,
      description = NULL,
      protocolType = "Acoustic",
      samplingDesign = NULL, # Required
      path = NULL,
      captureMethod = NULL, # Required
      individualAnimals = FALSE, # Required
      observationLevel = NULL # Required
    ), 
    "coordinatePrecision" = NULL,
    "spatial" = NULL, # Required (Sanne will do this)
    "temporal" = NULL, # Required (Sanne will do this)
    "taxonomic" = NULL, # Required (Sanne will do this)
    "relatedIdentifiers" = NULL,
    "references" = NULL
  )) %>%
  frictionless::create_package()
```

